# 提醒功能測試指南

## 概述
本文檔說明如何測試 DrowsyGuard 的疲勞提醒功能，包括視覺提醒和對話框警告。

## 測試前的準備

### 1. 已完成的修改
- ✅ 添加了視覺提醒覆蓋層 (`FatigueAlertOverlay`)
- ✅ 降低了疲勞事件閾值為 1（方便測試）
- ✅ 添加了詳細的調試日誌
- ✅ 完善了提醒觸發邏輯

### 2. 提醒系統組件
- **視覺提醒**：屏幕頂部的彩色覆蓋層
- **狀態文字**：導航欄中心的狀態提示
- **對話框警告**：WARNING 級別的強制回應對話框
- **聲音和震動**：背景警報效果

## 測試步驟

### 步驟 1：啟動應用程式
1. 安裝並啟動 DrowsyGuard 應用程式
2. 確保相機權限已授予
3. 觀察初始狀態：應該顯示「請面對鏡頭」

### 步驟 2：臉部偵測測試
1. 將臉部對準相機
2. 等待 1 秒後開始校正（顯示「正在校正中...」）
3. 校正完成後顯示「持續偵測中…」

### 步驟 3：疲勞行為測試

#### 測試 NOTICE 級別提醒（橙色提醒）
**觸發條件**：累積 1 個疲勞事件
**測試方法**：
1. 閉眼超過 1.5 秒
2. 或打哈欠持續 1 秒
3. 或眨眼頻率超過 20 次/分鐘

**預期結果**：
- 導航欄顯示「提醒」
- 屏幕頂部出現橙色覆蓋層，顯示「⚠️ 提醒：偵測到疲勞行為」
- 可能有聲音和震動提醒

#### 測試 WARNING 級別警告（紅色警告）
**觸發條件**：累積 2 個疲勞事件
**測試方法**：
1. 重複上述疲勞行為
2. 或連續閉眼超過 1.5 秒

**預期結果**：
- 導航欄顯示「警告」
- 屏幕頂部出現紅色覆蓋層，顯示「🚨 警告：請確認您的狀態」
- 彈出強制回應對話框
- 有緊急聲音和強烈震動

### 步驟 4：對話框測試
當 WARNING 級別觸發時：
1. 點擊「✅ 我已清醒」→ 重置疲勞狀態，返回正常偵測
2. 點擊「🛑 我會找地方休息」→ 顯示休息提醒對話框

### 步驟 5：臉部偵測中斷測試
1. 移開臉部或遮擋相機
2. 觀察是否顯示「請面對鏡頭」
3. 重新對準臉部，觀察是否重新開始校正

## 調試信息

### 查看日誌
使用 Android Studio 的 Logcat 查看以下標籤的日誌：
- `FatigueDetector` - 疲勞偵測詳細信息
- `FatigueDetectionManager` - 警報處理邏輯
- `FatigueAlertManager` - 提醒觸發狀態

### 關鍵日誌信息
```
FatigueDetector: 检测到眼睛闭合事件，持续时间: 1500ms，当前疲劳事件计数: 1
FatigueDetector: 确定疲劳级别: 事件计数=1, 阈值=1, 级别=NOTICE
FatigueDetectionManager: 觸發 NOTICE 級別提醒
```

## 常見問題排查

### 問題 1：沒有看到提醒
**可能原因**：
- 疲勞事件沒有正確觸發
- 臉部偵測不穩定
- 閾值設置過高

**解決方法**：
1. 檢查日誌中的疲勞事件計數
2. 確認臉部偵測狀態
3. 調整閾值設置

### 問題 2：提醒太敏感
**解決方法**：
1. 將 `FATIGUE_EVENT_THRESHOLD` 改回 3
2. 調整 EAR 和 MAR 閾值
3. 修改時間閾值

### 問題 3：對話框沒有彈出
**可能原因**：
- Context 不是 Activity
- Activity 已結束
- 權限問題

**解決方法**：
1. 檢查 Context 類型
2. 確認 Activity 狀態
3. 檢查權限設置

## 測試檢查清單

- [ ] 臉部偵測正常工作
- [ ] 校正流程正常執行
- [ ] NOTICE 級別提醒正確顯示
- [ ] WARNING 級別警告正確顯示
- [ ] 對話框正常彈出和響應
- [ ] 聲音和震動提醒正常工作
- [ ] 臉部偵測中斷處理正確
- [ ] 狀態重置功能正常

## 恢復生產設置

測試完成後，將疲勞事件閾值恢復為生產設置：

```kotlin
// 在 Constants.kt 中
const val FATIGUE_EVENT_THRESHOLD = 3 // 恢復為 3
```

## 總結

通過這個測試指南，您應該能夠：
1. 驗證提醒系統的各個組件是否正常工作
2. 確認視覺提醒和對話框警告的觸發條件
3. 調試和排查可能的問題
4. 確保整個疲勞偵測和提醒流程的完整性

如果測試中發現任何問題，請查看相應的日誌信息並根據排查方法進行修正。 