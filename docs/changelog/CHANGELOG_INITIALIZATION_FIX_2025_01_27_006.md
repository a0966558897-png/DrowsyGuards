# åˆå§‹åŒ–å•é¡Œä¿®å¾©è®Šæ›´æ—¥èªŒ

**ç‰ˆæœ¬**: 1.0.0  
**æ—¥æœŸ**: 2025å¹´1æœˆ27æ—¥  
**é¡å‹**: éŒ¯èª¤ä¿®å¾©  
**å„ªå…ˆç´š**: é«˜  

## ğŸ¯ å•é¡Œæè¿°

ç”¨æˆ¶å ±å‘Šç¨‹å¼å‰›é–‹å§‹æ™‚å°±æœƒè§¸ç™¼ notice äº‹ä»¶ï¼Œé€™æ˜¯ä¸€å€‹åš´é‡çš„åˆå§‹åŒ–å•é¡Œã€‚

## ğŸ” å•é¡Œåˆ†æ

### 1. æ ¹æœ¬åŸå› 
åœ¨ `FatigueDetector.determineFatigueLevel()` æ–¹æ³•ä¸­ï¼Œç–²å‹ç´šåˆ¥åˆ¤æ–·é‚è¼¯æœ‰å•é¡Œï¼š

```kotlin
// å•é¡Œä»£ç¢¼
when {
    fatigueEventCount >= currentFatigueEventThreshold -> FatigueLevel.WARNING
    fatigueEventCount >= currentFatigueEventThreshold / 2 -> FatigueLevel.NOTICE  // å•é¡Œåœ¨é€™è£¡
    else -> FatigueLevel.NORMAL
}
```

**å•é¡Œåˆ†æ**ï¼š
- `currentFatigueEventThreshold` é»˜èªå€¼ç‚º 1
- `currentFatigueEventThreshold / 2` ç­‰æ–¼ 0
- ç•¶ `fatigueEventCount >= 0` æ™‚å°±æœƒè§¸ç™¼ `NOTICE`
- é€™æ„å‘³è‘—ä»»ä½•éè² æ•¸çš„äº‹ä»¶è¨ˆæ•¸éƒ½æœƒè§¸ç™¼ notice

### 2. å…¶ä»–æ½›åœ¨å•é¡Œ
- `FatigueDetectionManager` å•Ÿå‹•æ™‚æ²’æœ‰å®Œå…¨é‡ç½®ç‹€æ…‹
- `FatigueUiStateManager` åˆå§‹åŒ–æ™‚æ²’æœ‰ç¢ºä¿ç‹€æ…‹æ­£å¸¸

## âœ… è§£æ±ºæ–¹æ¡ˆ

### 1. ä¿®å¾©ç–²å‹ç´šåˆ¥åˆ¤æ–·é‚è¼¯

**ä¿®æ”¹æ–‡ä»¶**: `detection-logic/src/main/java/com/patrick/detection/FatigueDetector.kt`

**è®Šæ›´å…§å®¹**:
```kotlin
// ä¿®å¾©å¾Œçš„ä»£ç¢¼
private fun determineFatigueLevel(): FatigueLevel {
    val level =
        when {
            fatigueEventCount >= currentFatigueEventThreshold -> FatigueLevel.WARNING
            fatigueEventCount > 0 && fatigueEventCount < currentFatigueEventThreshold -> FatigueLevel.NOTICE
            else -> FatigueLevel.NORMAL
        }

    Log.d(TAG, "ç¡®å®šç–²åŠ³çº§åˆ«: äº‹ä»¶è®¡æ•°=$fatigueEventCount, é˜ˆå€¼=$currentFatigueEventThreshold, çº§åˆ«=$level")
    return level
}
```

**ä¿®å¾©æ•ˆæœ**:
- åªæœ‰ç•¶ `fatigueEventCount > 0` æ™‚æ‰æœƒè§¸ç™¼ `NOTICE`
- é¿å…äº†åˆå§‹åŒ–æ™‚å°±è§¸ç™¼ notice çš„å•é¡Œ
- ä¿æŒäº†åˆç†çš„ç–²å‹ç´šåˆ¥åˆ¤æ–·é‚è¼¯

### 2. æ”¹é€² FatigueDetectionManager å•Ÿå‹•é‚è¼¯

**ä¿®æ”¹æ–‡ä»¶**: `detection-logic/src/main/java/com/patrick/detection/FatigueDetectionManager.kt`

**è®Šæ›´å…§å®¹**:
```kotlin
fun startDetection() {
    isDetectionActive = true
    isResetting = false
    isFaceDetected = false
    currentFatigueLevel = FatigueLevel.NORMAL
    
    // é‡ç½®ç–²å‹æª¢æ¸¬å™¨ç‹€æ…‹
    fatigueDetector.resetFatigueEvents()
    
    Log.d(TAG, "ç–²åŠ³æ£€æµ‹å·²å¯åŠ¨ï¼Œæ‰€æœ‰çŠ¶æ€å·²é‡ç½®")
}
```

**æ”¹é€²æ•ˆæœ**:
- ç¢ºä¿å•Ÿå‹•æ™‚æ‰€æœ‰ç‹€æ…‹éƒ½è¢«é‡ç½®
- é¿å…èˆŠç‹€æ…‹å½±éŸ¿æ–°çš„æª¢æ¸¬é€±æœŸ
- æä¾›æ›´è©³ç´°çš„æ—¥èªŒä¿¡æ¯

### 3. æ”¹é€² FatigueUiStateManager åˆå§‹åŒ–

**ä¿®æ”¹æ–‡ä»¶**: `ui-components/src/main/java/com/patrick/ui/fatigue/FatigueUiStateManager.kt`

**è®Šæ›´å…§å®¹**:
```kotlin
init {
    // ç¢ºä¿åˆå§‹åŒ–æ™‚ç‹€æ…‹æ­£å¸¸
    reset()
    Log.d(TAG, "FatigueUiStateManager åˆå§‹åŒ–å®Œæˆï¼Œç‹€æ…‹å·²é‡ç½®")
}
```

**æ”¹é€²æ•ˆæœ**:
- ç¢ºä¿ UI ç‹€æ…‹ç®¡ç†å™¨åˆå§‹åŒ–æ™‚ç‹€æ…‹æ­£å¸¸
- é¿å…åˆå§‹åŒ–æ™‚çš„ç‹€æ…‹ä¸ä¸€è‡´å•é¡Œ

## ğŸ§ª æ¸¬è©¦é©—è­‰

### 1. åˆå§‹åŒ–æ¸¬è©¦
- âœ… ç¨‹å¼å•Ÿå‹•æ™‚ä¸æœƒè§¸ç™¼ notice äº‹ä»¶
- âœ… æ‰€æœ‰ç‹€æ…‹éƒ½æ­£ç¢ºåˆå§‹åŒ–ç‚ºæ­£å¸¸ç‹€æ…‹
- âœ… ç–²å‹äº‹ä»¶è¨ˆæ•¸å¾ 0 é–‹å§‹

### 2. åŠŸèƒ½æ¸¬è©¦
- âœ… æ­£å¸¸çš„ç–²å‹æª¢æ¸¬åŠŸèƒ½ä»ç„¶æ­£å¸¸å·¥ä½œ
- âœ… ç–²å‹ç´šåˆ¥åˆ¤æ–·é‚è¼¯æ­£ç¢º
- âœ… UI ç‹€æ…‹æ›´æ–°æ­£å¸¸

### 3. æ—¥èªŒé©—è­‰
- âœ… å•Ÿå‹•æ™‚æœ‰æ­£ç¢ºçš„åˆå§‹åŒ–æ—¥èªŒ
- âœ… ç‹€æ…‹é‡ç½®æ—¥èªŒæ¸…æ™°å¯è¦‹
- âœ… ç–²å‹ç´šåˆ¥åˆ¤æ–·æ—¥èªŒæº–ç¢º

## ğŸ“Š ä¿®å¾©æ•ˆæœ

### ä¿®å¾©å‰
```
ç¨‹å¼å•Ÿå‹• â†’ ç«‹å³è§¸ç™¼ NOTICE äº‹ä»¶ â†’ ç”¨æˆ¶å›°æƒ‘
```

### ä¿®å¾©å¾Œ
```
ç¨‹å¼å•Ÿå‹• â†’ æ­£å¸¸åˆå§‹åŒ– â†’ ç­‰å¾…å¯¦éš›ç–²å‹äº‹ä»¶ â†’ æ­£ç¢ºè§¸ç™¼ç›¸æ‡‰ç´šåˆ¥
```

## ğŸ”§ æŠ€è¡“ç´°ç¯€

### 1. ç–²å‹ç´šåˆ¥åˆ¤æ–·é‚è¼¯
```kotlin
// ä¿®å¾©å‰ï¼šå®¹æ˜“èª¤è§¸ç™¼
fatigueEventCount >= currentFatigueEventThreshold / 2

// ä¿®å¾©å¾Œï¼šæ›´ç²¾ç¢ºçš„åˆ¤æ–·
fatigueEventCount > 0 && fatigueEventCount < currentFatigueEventThreshold
```

### 2. ç‹€æ…‹é‡ç½®é‚è¼¯
```kotlin
// ç¢ºä¿æ‰€æœ‰ç›¸é—œç‹€æ…‹éƒ½è¢«é‡ç½®
isDetectionActive = true
isResetting = false
isFaceDetected = false
currentFatigueLevel = FatigueLevel.NORMAL
fatigueDetector.resetFatigueEvents()
```

### 3. åˆå§‹åŒ–é †åº
```kotlin
// æ­£ç¢ºçš„åˆå§‹åŒ–é †åº
1. é‡ç½®æ‰€æœ‰ç‹€æ…‹
2. è¨­ç½®æª¢æ¸¬ç‚ºæ´»èº
3. è¨˜éŒ„åˆå§‹åŒ–æ—¥èªŒ
```

## ğŸ“ˆ å½±éŸ¿è©•ä¼°

### æ­£é¢å½±éŸ¿
1. **è§£æ±ºåˆå§‹åŒ–å•é¡Œ**: ç¨‹å¼å•Ÿå‹•æ™‚ä¸å†èª¤è§¸ç™¼ notice
2. **æå‡ç”¨æˆ¶é«”é©—**: ç”¨æˆ¶ä¸æœƒçœ‹åˆ°è«åå…¶å¦™çš„è­¦å‘Š
3. **æé«˜ç³»çµ±ç©©å®šæ€§**: åˆå§‹åŒ–é‚è¼¯æ›´åŠ å¥å£¯
4. **æ”¹å–„èª¿è©¦é«”é©—**: æ—¥èªŒæ›´åŠ æ¸…æ™°æº–ç¢º

### é¢¨éšªè©•ä¼°
- **ä½é¢¨éšª**: åªä¿®å¾©äº†åˆå§‹åŒ–é‚è¼¯ï¼Œä¸å½±éŸ¿æ ¸å¿ƒåŠŸèƒ½
- **å‘å¾Œå…¼å®¹**: ä¿æŒäº†åŸæœ‰çš„ API æ¥å£
- **åŠŸèƒ½å®Œæ•´**: æ‰€æœ‰åŠŸèƒ½éƒ½æ­£å¸¸å·¥ä½œ

## ğŸ”® é é˜²æªæ–½

### 1. ä»£ç¢¼å¯©æŸ¥
- åœ¨ä¿®æ”¹ç–²å‹ç´šåˆ¥åˆ¤æ–·é‚è¼¯æ™‚è¦ç‰¹åˆ¥æ³¨æ„é‚Šç•Œæ¢ä»¶
- ç¢ºä¿åˆå§‹åŒ–é‚è¼¯çš„å®Œæ•´æ€§

### 2. æ¸¬è©¦è¦†è“‹
- æ·»åŠ åˆå§‹åŒ–æ¸¬è©¦ç”¨ä¾‹
- ç¢ºä¿å„ç¨®é‚Šç•Œæ¢ä»¶éƒ½è¢«æ¸¬è©¦

### 3. æ—¥èªŒç›£æ§
- ç›£æ§åˆå§‹åŒ–éç¨‹çš„æ—¥èªŒ
- åŠæ™‚ç™¼ç¾é¡ä¼¼çš„åˆå§‹åŒ–å•é¡Œ

## ğŸ“ ç¸½çµ

é€™æ¬¡ä¿®å¾©æˆåŠŸè§£æ±ºäº†ç¨‹å¼å•Ÿå‹•æ™‚èª¤è§¸ç™¼ notice äº‹ä»¶çš„å•é¡Œï¼š

1. **æ ¹æœ¬åŸå› æ˜ç¢º**: ç–²å‹ç´šåˆ¥åˆ¤æ–·é‚è¼¯çš„é‚Šç•Œæ¢ä»¶å•é¡Œ
2. **è§£æ±ºæ–¹æ¡ˆç²¾ç¢º**: ä¿®æ”¹åˆ¤æ–·é‚è¼¯ï¼Œç¢ºä¿åªæœ‰å¯¦éš›äº‹ä»¶æ‰è§¸ç™¼
3. **æ”¹é€²å…¨é¢**: åŒæ™‚æ”¹é€²äº†å¤šå€‹ç›¸é—œçµ„ä»¶çš„åˆå§‹åŒ–é‚è¼¯
4. **æ•ˆæœé¡¯è‘—**: ç”¨æˆ¶é«”é©—å¾—åˆ°æ˜é¡¯æ”¹å–„

ä¿®å¾©å¾Œçš„ç³»çµ±æ›´åŠ ç©©å®šå¯é ï¼Œç‚ºå¾ŒçºŒçš„åŠŸèƒ½é–‹ç™¼æä¾›äº†è‰¯å¥½çš„åŸºç¤ã€‚ 