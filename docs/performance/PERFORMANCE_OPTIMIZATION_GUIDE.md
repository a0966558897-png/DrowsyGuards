# æ€§èƒ½å„ªåŒ–æŒ‡å—

## æ¦‚è¿°

æœ¬æ–‡æª”æè¿°äº† DrowsyGuard é …ç›®çš„æ€§èƒ½å„ªåŒ–ç­–ç•¥ã€å·¥å…·å’Œæœ€ä½³å¯¦è¸ã€‚

## æ€§èƒ½å„ªåŒ–æ¶æ§‹

### æ€§èƒ½ç›£æ§é«”ç³»

```
ğŸ“Š æ€§èƒ½ç›£æ§
â”œâ”€â”€ ğŸ§  å…§å­˜ç›£æ§
â”œâ”€â”€ âš¡ CPU ç›£æ§
â”œâ”€â”€ ğŸ”‹ é›»æ± ç›£æ§
â””â”€â”€ â±ï¸ å•Ÿå‹•æ™‚é–“ç›£æ§
```

### å„ªåŒ–ç­–ç•¥

1. **é é˜²æ€§å„ªåŒ–**
   - ä»£ç¢¼å¯©æŸ¥
   - æ€§èƒ½æ¸¬è©¦
   - ç›£æ§è­¦å ±

2. **åæ‡‰æ€§å„ªåŒ–**
   - æ€§èƒ½åˆ†æ
   - ç“¶é ¸è­˜åˆ¥
   - é‡å°æ€§å„ªåŒ–

## æ€§èƒ½ç›£æ§å·¥å…·

### PerformanceMonitor

```kotlin
// åˆå§‹åŒ–
val monitor = PerformanceMonitor.getInstance(context)
monitor.initialize()

// è¨˜éŒ„æ€§èƒ½æŒ‡æ¨™
monitor.logPerformance("Operation completed", mapOf(
    "duration" to "100ms",
    "memory" to "50MB"
))

// æ¸¬é‡åŸ·è¡Œæ™‚é–“
val result = monitor.measureExecutionTime("Heavy Operation") {
    // åŸ·è¡Œæ“ä½œ
}
```

### ç›£æ§æŒ‡æ¨™

1. **å…§å­˜ä½¿ç”¨**
   - å †å¤§å°
   - å…§å­˜æ´©æ¼
   - GC é »ç‡

2. **CPU ä½¿ç”¨**
   - ä¸»ç·šç¨‹ä½¿ç”¨ç‡
   - èƒŒæ™¯ç·šç¨‹ä½¿ç”¨ç‡
   - ç†±é»æ–¹æ³•

3. **é›»æ± ä½¿ç”¨**
   - å‰å°è€—é›»
   - èƒŒæ™¯è€—é›»
   - å–šé†’æ¬¡æ•¸

4. **å•Ÿå‹•æ™‚é–“**
   - å†·å•Ÿå‹•æ™‚é–“
   - ç†±å•Ÿå‹•æ™‚é–“
   - å•Ÿå‹•ç“¶é ¸

## å…§å­˜å„ªåŒ–

### å°è±¡æ± ç®¡ç†

```kotlin
// å‰µå»ºå°è±¡æ± 
val bitmapPool = BitmapPool(maxSize = 10)
val byteArrayPool = ByteArrayPool(bufferSize = 1024, maxSize = 20)

// ä½¿ç”¨å°è±¡æ± 
val bitmap = bitmapPool.borrow()
try {
    // ä½¿ç”¨ bitmap
} finally {
    bitmapPool.return(bitmap)
}
```

### å…§å­˜å„ªåŒ–æœ€ä½³å¯¦è¸

1. **åŠæ™‚é‡‹æ”¾è³‡æº**
   ```kotlin
   // å¥½çš„åšæ³•
   bitmap.recycle()
   stream.close()
   ```

2. **é¿å…å…§å­˜æ´©æ¼**
   ```kotlin
   // é¿å…éœæ…‹å¼•ç”¨
   // ä½¿ç”¨å¼±å¼•ç”¨
   // åŠæ™‚å–æ¶ˆå›èª¿
   ```

3. **å„ªåŒ–å­—ç¬¦ä¸²æ“ä½œ**
   ```kotlin
   // ä½¿ç”¨ StringBuilder
   val builder = StringBuilder()
   builder.append("Hello").append(" World")
   ```

## CPU å„ªåŒ–

### ç•°æ­¥è™•ç†

```kotlin
// ä½¿ç”¨å”ç¨‹
val asyncTaskManager = AsyncTaskManager.getInstance(context)

// è¼•é‡ç´šä»»å‹™
asyncTaskManager.executeLightTask("Data Processing") {
    // è™•ç†æ•¸æ“š
}

// é‡é‡ç´šä»»å‹™
asyncTaskManager.executeHeavyTask("File Processing") {
    // è™•ç†æ–‡ä»¶
}
```

### CPU å„ªåŒ–æœ€ä½³å¯¦è¸

1. **é¿å…ä¸»ç·šç¨‹é˜»å¡**
   ```kotlin
   // å¥½çš„åšæ³•
   withContext(Dispatchers.IO) {
       // åŸ·è¡Œ I/O æ“ä½œ
   }
   ```

2. **å„ªåŒ–ç®—æ³•**
   ```kotlin
   // ä½¿ç”¨ç·©å­˜
   // æ¸›å°‘é‡è¤‡è¨ˆç®—
   // å„ªåŒ–å¾ªç’°
   ```

3. **åˆç†ä½¿ç”¨ç·šç¨‹æ± **
   ```kotlin
   // ä½¿ç”¨ WorkManager
   // é¿å…å‰µå»ºéå¤šç·šç¨‹
   ```

## å•Ÿå‹•å„ªåŒ–

### å•Ÿå‹•å„ªåŒ–ç­–ç•¥

1. **æ‡¶åŠ è¼‰**
   ```kotlin
   // ä½¿ç”¨ AndroidX Startup
   class StartupInitializer : Initializer<Unit> {
       override fun create(context: Context) {
           // é—œéµåˆå§‹åŒ–
       }
   }
   ```

2. **èƒŒæ™¯åˆå§‹åŒ–**
   ```kotlin
   // éé—œéµåˆå§‹åŒ–ç§»åˆ°èƒŒæ™¯
   CoroutineScope(Dispatchers.IO).launch {
       // é åŠ è¼‰è³‡æº
   }
   ```

3. **çµ„ä»¶ä¾è³´å„ªåŒ–**
   ```kotlin
   // æ¸›å°‘å•Ÿå‹•æ™‚ä¾è³´
   // ä½¿ç”¨ä¾è³´æ³¨å…¥
   ```

### å•Ÿå‹•æ™‚é–“åŸºæº–

- **å†·å•Ÿå‹•**: < 3ç§’
- **ç†±å•Ÿå‹•**: < 1ç§’
- **æº«å•Ÿå‹•**: < 2ç§’

## é›»æ± å„ªåŒ–

### é›»æ± å„ªåŒ–ç­–ç•¥

1. **å¾Œå°ä»»å‹™ç®¡ç†**
   ```kotlin
   // ä½¿ç”¨ WorkManager
   val constraints = Constraints.Builder()
       .setRequiresBatteryNotLow(true)
       .build()
   ```

2. **å‚³æ„Ÿå™¨å„ªåŒ–**
   ```kotlin
   // åŠæ™‚åœæ­¢å‚³æ„Ÿå™¨
   // ä½¿ç”¨ä½åŠŸè€—æ¨¡å¼
   // å¯¦ç¾å‚³æ„Ÿå™¨ä¼‘çœ 
   ```

3. **ç¶²çµ¡è«‹æ±‚å„ªåŒ–**
   ```kotlin
   // æ‰¹é‡è«‹æ±‚
   // ç·©å­˜çµæœ
   // æ¸›å°‘è«‹æ±‚é »ç‡
   ```

### é›»æ± ä½¿ç”¨åŸºæº–

- **å‰å°ä½¿ç”¨**: < 10%/å°æ™‚
- **èƒŒæ™¯ä½¿ç”¨**: < 2%/å°æ™‚
- **å¾…æ©Ÿæ™‚é–“**: > 24å°æ™‚

## UI å„ªåŒ–

### æ¸²æŸ“å„ªåŒ–

1. **æ¸›å°‘éåº¦ç¹ªè£½**
   ```kotlin
   // ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿ
   // å„ªåŒ–ä½ˆå±€å±¤æ¬¡
   // é¿å…ä¸å¿…è¦çš„ç¹ªè£½
   ```

2. **å‹•ç•«å„ªåŒ–**
   ```kotlin
   // ä½¿ç”¨å±¬æ€§å‹•ç•«
   // å„ªåŒ–å‹•ç•«æ€§èƒ½
   // å¯¦ç¾å‹•ç•«ç·©å­˜
   ```

3. **åˆ—è¡¨å„ªåŒ–**
   ```kotlin
   // å¯¦ç¾è¦–åœ–å›æ”¶
   // å„ªåŒ–é©é…å™¨
   // ä½¿ç”¨åˆ†é åŠ è¼‰
   ```

### UI æ€§èƒ½åŸºæº–

- **å¹€ç‡**: 60 FPS
- **éŸ¿æ‡‰æ™‚é–“**: < 16ms
- **æ»¾å‹•æµæš¢åº¦**: ç„¡å¡é “

## æ€§èƒ½æ¸¬è©¦

### æ¸¬è©¦é¡å‹

1. **åŸºæº–æ¸¬è©¦**
   ```bash
   ./gradlew benchmark
   ```

2. **æ€§èƒ½åˆ†æ**
   ```bash
   ./gradlew profile
   ```

3. **å…§å­˜åˆ†æ**
   ```bash
   # ä½¿ç”¨ Android Studio Profiler
   # æˆ– LeakCanary
   ```

### æ¸¬è©¦å·¥å…·

- **Android Studio Profiler**
- **LeakCanary**
- **Systrace**
- **TraceView**

## æ€§èƒ½ç›£æ§

### ç›£æ§æŒ‡æ¨™

1. **é—œéµæŒ‡æ¨™**
   - ANR ç‡
   - å´©æ½°ç‡
   - å•Ÿå‹•æ™‚é–“
   - å…§å­˜ä½¿ç”¨

2. **æ¥­å‹™æŒ‡æ¨™**
   - ç–²å‹æª¢æ¸¬æº–ç¢ºç‡
   - è­¦å ±éŸ¿æ‡‰æ™‚é–“
   - ç”¨æˆ¶æ»¿æ„åº¦

### ç›£æ§å·¥å…·

- **Firebase Performance**
- **Crashlytics**
- **è‡ªå®šç¾©ç›£æ§**

## æ€§èƒ½å„ªåŒ–æµç¨‹

### 1. æ€§èƒ½åˆ†æ

```bash
# é‹è¡Œæ€§èƒ½åˆ†æ
./scripts/performance-optimization.sh all
```

### 2. ç“¶é ¸è­˜åˆ¥

1. åˆ†ææ€§èƒ½å ±å‘Š
2. è­˜åˆ¥ç†±é»æ–¹æ³•
3. ç¢ºå®šå„ªåŒ–ç›®æ¨™

### 3. å„ªåŒ–å¯¦æ–½

1. å¯¦æ–½å„ªåŒ–æ–¹æ¡ˆ
2. é‹è¡Œæ€§èƒ½æ¸¬è©¦
3. é©—è­‰å„ªåŒ–æ•ˆæœ

### 4. æŒçºŒç›£æ§

1. éƒ¨ç½²æ€§èƒ½ç›£æ§
2. è¨­ç½®è­¦å ±é–¾å€¼
3. å®šæœŸæ€§èƒ½å¯©æŸ¥

## æ€§èƒ½åŸºæº–

### å…§å­˜åŸºæº–

- **å †å¤§å°**: < 200MB
- **å…§å­˜æ´©æ¼**: 0
- **GC é »ç‡**: < 5æ¬¡/åˆ†é˜

### CPU åŸºæº–

- **ä¸»ç·šç¨‹ä½¿ç”¨ç‡**: < 80%
- **èƒŒæ™¯ç·šç¨‹ä½¿ç”¨ç‡**: < 50%
- **ANR ç‡**: < 0.1%

### é›»æ± åŸºæº–

- **å‰å°è€—é›»**: < 10%/å°æ™‚
- **èƒŒæ™¯è€—é›»**: < 2%/å°æ™‚
- **å¾…æ©Ÿæ™‚é–“**: > 24å°æ™‚

### å•Ÿå‹•åŸºæº–

- **å†·å•Ÿå‹•**: < 3ç§’
- **ç†±å•Ÿå‹•**: < 1ç§’
- **æº«å•Ÿå‹•**: < 2ç§’

## æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **å…§å­˜æ´©æ¼**
   - æª¢æŸ¥éœæ…‹å¼•ç”¨
   - æª¢æŸ¥å›èª¿è¨»å†Š
   - ä½¿ç”¨ LeakCanary

2. **ANR**
   - æª¢æŸ¥ä¸»ç·šç¨‹é˜»å¡
   - å„ªåŒ– I/O æ“ä½œ
   - ä½¿ç”¨ç•°æ­¥è™•ç†

3. **é›»æ± è€—é›»**
   - æª¢æŸ¥å¾Œå°ä»»å‹™
   - å„ªåŒ–å‚³æ„Ÿå™¨ä½¿ç”¨
   - æ¸›å°‘ç¶²çµ¡è«‹æ±‚

### èª¿è©¦æŠ€å·§

```kotlin
// å•Ÿç”¨åš´æ ¼æ¨¡å¼
if (BuildConfig.DEBUG) {
    StrictMode.enableDefaults()
}

// æ€§èƒ½æ—¥èªŒ
PerformanceMonitor.getInstance(context)
    .logPerformance("Debug info", mapOf("key" to "value"))
```

## åƒè€ƒè³‡æº

- [Android Performance Patterns](https://www.youtube.com/playlist?list=PLWz5rJ2EKKc9CBxr3BVjPTPoDPLdPIFCE)
- [Android Performance](https://developer.android.com/topic/performance)
- [Memory Management](https://developer.android.com/topic/performance/memory)
- [Battery Optimization](https://developer.android.com/topic/performance/power)

---

**æ³¨æ„**: æ€§èƒ½å„ªåŒ–æ˜¯ä¸€å€‹æŒçºŒçš„éç¨‹ï¼Œéœ€è¦å®šæœŸç›£æ§å’Œèª¿æ•´ã€‚ 